{"ast":null,"code":"import { chatAPI } from '../components/api/chat-api.ts';\nconst MESSAGES_RECEVIED = 'SN/chat/MESSAGES_RECEVIED';\nconst STATUS_CHANGED = 'STATUS_CHANGED';\nlet initialState = {\n  messages: [],\n  status: 'pending'\n};\nexport const chatReducer = function () {\n  let state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  let action = arguments.length > 1 ? arguments[1] : undefined;\n  switch (action.type) {\n    case MESSAGES_RECEVIED:\n      return {\n        ...state,\n        messages: [...state.messages, ...action.payload]\n      };\n    case STATUS_CHANGED:\n      return {\n        ...state,\n        status: action.payload\n      };\n    default:\n      return state;\n  }\n};\nconst actions = {\n  setMessages: messages => ({\n    type: MESSAGES_RECEVIED,\n    payload: messages\n  }),\n  statusChanged: status => ({\n    type: STATUS_CHANGED,\n    payload: status\n  })\n};\nlet _newMessageHanbler = null;\nlet _statusChangedeHanbler = null;\nconst newMessageHanbler = dispatch => {\n  if (_newMessageHanbler === null) {\n    _newMessageHanbler = messages => {\n      dispatch(actions.setMessages(messages));\n    };\n  }\n  return _newMessageHanbler;\n};\nconst statusChangedeHanbler = dispatch => {\n  if (_statusChangedeHanbler === null) {\n    _statusChangedeHanbler = status => {\n      dispatch(actions.statusChanged(status));\n    };\n  }\n  return _statusChangedeHanbler;\n};\nexport const startMessagesListening = () => async dispatch => {\n  chatAPI.start();\n  chatAPI.subscribe('messages-received', newMessageHanbler(dispatch));\n  chatAPI.subscribe('status-changed', statusChangedeHanbler(dispatch));\n};\nexport const stopMessagesListening = () => async dispatch => {\n  chatAPI.unsubscribe('messages-received', newMessageHanbler(dispatch));\n  chatAPI.unsubscribe('status-changed', statusChangedeHanbler(dispatch));\n  chatAPI.stop();\n};\nexport const sendMessage = message => async dispatch => {\n  chatAPI.sendMessage(message);\n};\nexport default chatReducer;","map":{"version":3,"names":["chatAPI","MESSAGES_RECEVIED","STATUS_CHANGED","initialState","messages","status","chatReducer","state","action","type","payload","actions","setMessages","statusChanged","_newMessageHanbler","_statusChangedeHanbler","newMessageHanbler","dispatch","statusChangedeHanbler","startMessagesListening","start","subscribe","stopMessagesListening","unsubscribe","stop","sendMessage","message"],"sources":["C:/Dev/react/project1/src/redux/chat-reducer.ts"],"sourcesContent":["import {ChatMessageType, chatAPI} from '../components/api/chat-api.ts'\r\nimport {FormAction} from 'redux-form'\r\nimport { BaseThunkType, InferActionsType } from './redux-store';\r\nimport { Dispatch } from 'redux';\r\n\r\nconst MESSAGES_RECEVIED = 'SN/chat/MESSAGES_RECEVIED'\r\nconst STATUS_CHANGED = 'STATUS_CHANGED'\r\nlet initialState =  {\r\n    messages:[] as ChatMessageType[],\r\n    status:'pending' as StatusType\r\n}\r\ntype ActionsType = InferActionsType<typeof actions>\r\ntype ThunkType = BaseThunkType<ActionsType | FormAction>\r\nexport type StatusType = 'pending' | 'ready' | 'error'\r\ntype initialState = typeof initialState\r\nexport const chatReducer = (state:initialState = initialState,action:ActionsType):initialState =>{\r\n  switch(action.type) {\r\n    case MESSAGES_RECEVIED: \r\n        return { \r\n            ...state,\r\n            messages:[...state.messages,...action.payload]\r\n        }\r\n      case STATUS_CHANGED: \r\n        return { \r\n            ...state,\r\n           status:action.payload\r\n        }\r\n    default: \r\n        return state;\r\n  }\r\n}\r\nconst actions = {\r\n  setMessages:(messages:ChatMessageType[]) => ({\r\n    type:MESSAGES_RECEVIED, payload:messages\r\n  }),\r\n  statusChanged:(status:StatusType) => ({\r\n    type:STATUS_CHANGED,payload:status\r\n  })\r\n}\r\nlet _newMessageHanbler:((messages:ChatMessageType[]) => void) | null = null\r\nlet _statusChangedeHanbler:((status:StatusType) => void) | null = null\r\n\r\n\r\nconst newMessageHanbler = (dispatch:Dispatch) => {\r\n    if(_newMessageHanbler === null) {\r\n      _newMessageHanbler = (messages:ChatMessageType[]) => {\r\n        dispatch(actions.setMessages(messages))\r\n      }\r\n    }\r\n    return _newMessageHanbler\r\n} \r\n\r\n\r\nconst statusChangedeHanbler = (dispatch:Dispatch) => {\r\n  if(_statusChangedeHanbler === null) {\r\n    _statusChangedeHanbler = (status:StatusType) => {\r\n      dispatch(actions.statusChanged(status))\r\n    }\r\n  }\r\n  return _statusChangedeHanbler\r\n} \r\nexport const startMessagesListening = ():ThunkType => async (dispatch) => {\r\n  chatAPI.start() \r\n  chatAPI.subscribe('messages-received',newMessageHanbler(dispatch))\r\n  chatAPI.subscribe('status-changed',statusChangedeHanbler(dispatch))\r\n}\r\nexport const stopMessagesListening = ():ThunkType => async (dispatch) => {\r\n    chatAPI.unsubscribe('messages-received',newMessageHanbler(dispatch))\r\n    chatAPI.unsubscribe('status-changed',statusChangedeHanbler(dispatch))\r\n    chatAPI.stop()\r\n }\r\nexport const sendMessage = (message:string):ThunkType => async (dispatch) => {\r\n  chatAPI.sendMessage(message)\r\n}\r\nexport default chatReducer;"],"mappings":"AAAA,SAAyBA,OAAO,QAAO,+BAA+B;AAKtE,MAAMC,iBAAiB,GAAG,2BAA2B;AACrD,MAAMC,cAAc,GAAG,gBAAgB;AACvC,IAAIC,YAAY,GAAI;EAChBC,QAAQ,EAAC,EAAuB;EAChCC,MAAM,EAAC;AACX,CAAC;AAKD,OAAO,MAAMC,WAAW,GAAG,YAAsE;EAAA,IAArEC,KAAkB,uEAAGJ,YAAY;EAAA,IAACK,MAAkB;EAC9E,QAAOA,MAAM,CAACC,IAAI;IAChB,KAAKR,iBAAiB;MAClB,OAAO;QACH,GAAGM,KAAK;QACRH,QAAQ,EAAC,CAAC,GAAGG,KAAK,CAACH,QAAQ,EAAC,GAAGI,MAAM,CAACE,OAAO;MACjD,CAAC;IACH,KAAKR,cAAc;MACjB,OAAO;QACH,GAAGK,KAAK;QACTF,MAAM,EAACG,MAAM,CAACE;MACjB,CAAC;IACL;MACI,OAAOH,KAAK;EAAC;AAErB,CAAC;AACD,MAAMI,OAAO,GAAG;EACdC,WAAW,EAAER,QAA0B,KAAM;IAC3CK,IAAI,EAACR,iBAAiB;IAAES,OAAO,EAACN;EAClC,CAAC,CAAC;EACFS,aAAa,EAAER,MAAiB,KAAM;IACpCI,IAAI,EAACP,cAAc;IAACQ,OAAO,EAACL;EAC9B,CAAC;AACH,CAAC;AACD,IAAIS,kBAAgE,GAAG,IAAI;AAC3E,IAAIC,sBAA2D,GAAG,IAAI;AAGtE,MAAMC,iBAAiB,GAAIC,QAAiB,IAAK;EAC7C,IAAGH,kBAAkB,KAAK,IAAI,EAAE;IAC9BA,kBAAkB,GAAIV,QAA0B,IAAK;MACnDa,QAAQ,CAACN,OAAO,CAACC,WAAW,CAACR,QAAQ,CAAC,CAAC;IACzC,CAAC;EACH;EACA,OAAOU,kBAAkB;AAC7B,CAAC;AAGD,MAAMI,qBAAqB,GAAID,QAAiB,IAAK;EACnD,IAAGF,sBAAsB,KAAK,IAAI,EAAE;IAClCA,sBAAsB,GAAIV,MAAiB,IAAK;MAC9CY,QAAQ,CAACN,OAAO,CAACE,aAAa,CAACR,MAAM,CAAC,CAAC;IACzC,CAAC;EACH;EACA,OAAOU,sBAAsB;AAC/B,CAAC;AACD,OAAO,MAAMI,sBAAsB,GAAG,MAAgB,MAAOF,QAAQ,IAAK;EACxEjB,OAAO,CAACoB,KAAK,EAAE;EACfpB,OAAO,CAACqB,SAAS,CAAC,mBAAmB,EAACL,iBAAiB,CAACC,QAAQ,CAAC,CAAC;EAClEjB,OAAO,CAACqB,SAAS,CAAC,gBAAgB,EAACH,qBAAqB,CAACD,QAAQ,CAAC,CAAC;AACrE,CAAC;AACD,OAAO,MAAMK,qBAAqB,GAAG,MAAgB,MAAOL,QAAQ,IAAK;EACrEjB,OAAO,CAACuB,WAAW,CAAC,mBAAmB,EAACP,iBAAiB,CAACC,QAAQ,CAAC,CAAC;EACpEjB,OAAO,CAACuB,WAAW,CAAC,gBAAgB,EAACL,qBAAqB,CAACD,QAAQ,CAAC,CAAC;EACrEjB,OAAO,CAACwB,IAAI,EAAE;AACjB,CAAC;AACF,OAAO,MAAMC,WAAW,GAAIC,OAAc,IAAe,MAAOT,QAAQ,IAAK;EAC3EjB,OAAO,CAACyB,WAAW,CAACC,OAAO,CAAC;AAC9B,CAAC;AACD,eAAepB,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}
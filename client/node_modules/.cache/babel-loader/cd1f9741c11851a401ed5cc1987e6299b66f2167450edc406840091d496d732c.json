{"ast":null,"code":"import _regeneratorRuntime from\"C:/Dev/react/project1/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Dev/react/project1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"C:/Dev/react/project1/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"C:/Dev/react/project1/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{userAPI}from'./../components/api/api';import{updateObjectInArray}from'./../utials/object-helpers';var FOLLOW='FOLLOW';var UNFOLLOW='UNFOLLOW';var SET_USERS='SET_USERS';var SET_CURRENT_PAGE=' SET_CURRENT_PAGE';var SET_TOTAL_USERS_COUNT='SET_TOTAL_USERS_COUNT';var TOGGLE_IS_FETCHING='TOGGLE_IS_FETCHING';var TOGGLE_IS_FOLLOWING_PROGRESS='TOGGLE_IS_FOLLOWING_PROGRESS';var initialState={users:[],pageSize:5,totalUsersCount:0,currentPage:1,isFetching:true,folowingInProgress:[]};//users: updateObjectInArray(state.users,action.userId,'id',{followed:true})\n/*\r\nstate.users.map( u => {\r\n              if(u.id === action.userId) {\r\n                return {...u, followed:true}\r\n              }\r\n              return u\r\n            })\r\n            */var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:{return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,'id',{followed:true})});}case UNFOLLOW:{return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,'id',{followed:false})});}case SET_USERS:{return _objectSpread(_objectSpread({},state),{},{users:action.users});}case SET_CURRENT_PAGE:{return _objectSpread(_objectSpread({},state),{},{currentPage:action.currentPage});}case SET_TOTAL_USERS_COUNT:{return _objectSpread(_objectSpread({},state),{},{totalUsersCount:action.totalUsersCount});}case TOGGLE_IS_FETCHING:{return _objectSpread(_objectSpread({},state),{},{isFetching:action.isFetching});}case TOGGLE_IS_FOLLOWING_PROGRESS:{return _objectSpread(_objectSpread({},state),{},{folowingInProgress:action.isFetching?[].concat(_toConsumableArray(state.folowingInProgress),[action.userId]):[state.folowingInProgress.filter(function(id){return id!==action.userId;})]});}default:{return state;}}};export var acceptFollow=function acceptFollow(userId){return{type:FOLLOW,userId:userId};};export var acceptUnfollow=function acceptUnfollow(userId){return{type:UNFOLLOW,userId:userId};};export var setUsersAC=function setUsersAC(users){return{type:SET_USERS,users:users};};export var setCurrentPage=function setCurrentPage(currentPage){return{type:SET_CURRENT_PAGE,currentPage:currentPage};};export var setTotalUsersCount=function setTotalUsersCount(totalUsersCount){return{type:SET_TOTAL_USERS_COUNT,totalUsersCount:totalUsersCount};};export var toggleIsFetching=function toggleIsFetching(isFetching){return{type:TOGGLE_IS_FETCHING,isFetching:isFetching};};export var toggleFollowingProgress=function toggleFollowingProgress(isFetching,userId){return{type:TOGGLE_IS_FOLLOWING_PROGRESS,isFetching:isFetching,userId:userId};};export var getUsers=function getUsers(currentPage,pageSize){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:dispatch(toggleIsFetching(true));dispatch(setCurrentPage(currentPage));_context.next=4;return userAPI.getUsers(currentPage,pageSize);case 4:data=_context.sent;dispatch(toggleIsFetching(false));dispatch(setUsersAC(data.items));dispatch(setTotalUsersCount(data.totalCount));case 8:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};var followUnfollowFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch,userId,apiMethod,AC){var response;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:dispatch(toggleFollowingProgress(true,userId));_context2.next=3;return apiMethod(userId);case 3:response=_context2.sent;if(response.data.resultCode===0){dispatch(AC(userId));}dispatch(toggleFollowingProgress(false,userId));case 6:case\"end\":return _context2.stop();}},_callee2);}));return function followUnfollowFlow(_x2,_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(dispatch){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:followUnfollowFlow(dispatch,userId,userAPI.follow.bind(userAPI),acceptFollow);case 1:case\"end\":return _context3.stop();}},_callee3);}));return function(_x6){return _ref3.apply(this,arguments);};}();};export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(dispatch){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:followUnfollowFlow(dispatch,userId,userAPI.unfollow.bind(userAPI),acceptUnfollow);case 1:case\"end\":return _context4.stop();}},_callee4);}));return function(_x7){return _ref4.apply(this,arguments);};}();};export default usersReducer;","map":{"version":3,"names":["userAPI","updateObjectInArray","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_USERS_COUNT","TOGGLE_IS_FETCHING","TOGGLE_IS_FOLLOWING_PROGRESS","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","folowingInProgress","usersReducer","state","action","type","userId","followed","filter","id","acceptFollow","acceptUnfollow","setUsersAC","setCurrentPage","setTotalUsersCount","toggleIsFetching","toggleFollowingProgress","getUsers","dispatch","data","items","totalCount","followUnfollowFlow","apiMethod","AC","response","resultCode","follow","bind","unfollow"],"sources":["C:/Dev/react/project1/src/redux/users-reducer.js"],"sourcesContent":["import {userAPI} from './../components/api/api';\r\nimport {updateObjectInArray} from './../utials/object-helpers'\r\nconst FOLLOW = 'FOLLOW'\r\nconst UNFOLLOW = 'UNFOLLOW'\r\nconst SET_USERS = 'SET_USERS'\r\nconst SET_CURRENT_PAGE = ' SET_CURRENT_PAGE'\r\nconst SET_TOTAL_USERS_COUNT = 'SET_TOTAL_USERS_COUNT'\r\nconst TOGGLE_IS_FETCHING = 'TOGGLE_IS_FETCHING'\r\nconst TOGGLE_IS_FOLLOWING_PROGRESS = 'TOGGLE_IS_FOLLOWING_PROGRESS'\r\n\r\n\r\nlet initialState = {\r\n  users: [],\r\n  pageSize: 5,\r\n  totalUsersCount: 0,\r\n  currentPage:1,\r\n  isFetching:true,\r\n  folowingInProgress:[],\r\n}\r\n//users: updateObjectInArray(state.users,action.userId,'id',{followed:true})\r\n\r\n/*\r\nstate.users.map( u => {\r\n              if(u.id === action.userId) {\r\n                return {...u, followed:true}\r\n              }\r\n              return u\r\n            })\r\n            */\r\nconst usersReducer = (state = initialState,action) =>{\r\n    switch(action.type){\r\n      \r\n        case FOLLOW: {\r\n          return { \r\n            ...state, \r\n            users: updateObjectInArray(state.users,action.userId,'id',{followed:true})\r\n          }\r\n        }\r\n        case UNFOLLOW: {\r\n          return { \r\n            ...state, \r\n            users: updateObjectInArray(state.users,action.userId,'id',{followed:false})\r\n          }\r\n        }\r\n        case SET_USERS : {\r\n          return {\r\n            ...state, users:action.users \r\n          }\r\n        }\r\n        case SET_CURRENT_PAGE : {\r\n          return {\r\n            ...state, currentPage:action.currentPage \r\n          }\r\n        }\r\n        case SET_TOTAL_USERS_COUNT : {\r\n          return {\r\n            ...state, totalUsersCount:action.totalUsersCount\r\n          }\r\n        }\r\n        case TOGGLE_IS_FETCHING : {\r\n          return {\r\n            ...state, isFetching:action.isFetching\r\n          }\r\n        }\r\n        case TOGGLE_IS_FOLLOWING_PROGRESS : {\r\n          return {\r\n            ...state, folowingInProgress:action.isFetching\r\n            ?[...state.folowingInProgress ,action.userId]\r\n            :[state.folowingInProgress.filter(id => id !== action.userId)]\r\n          }\r\n        }\r\n        default: {\r\n            return state;\r\n        }\r\n  }\r\n}\r\nexport const acceptFollow = (userId) => ({type:FOLLOW , userId})\r\nexport const acceptUnfollow = (userId) => ({type:UNFOLLOW,userId})\r\nexport const setUsersAC = (users) => ({type:SET_USERS,users})\r\nexport const setCurrentPage = (currentPage) => ({type:SET_CURRENT_PAGE, currentPage})\r\nexport const setTotalUsersCount = (totalUsersCount) => ({type:SET_TOTAL_USERS_COUNT, totalUsersCount})\r\nexport const toggleIsFetching = (isFetching) => ({type:TOGGLE_IS_FETCHING, isFetching})\r\nexport const toggleFollowingProgress = (isFetching,userId) => ({type:TOGGLE_IS_FOLLOWING_PROGRESS, isFetching,userId})\r\n\r\n\r\nexport const getUsers = (currentPage,pageSize) => { \r\n  return async (dispatch) => {\r\n    dispatch(toggleIsFetching(true))\r\n    dispatch(setCurrentPage(currentPage))\r\n    let data = await userAPI.getUsers(currentPage,pageSize)\r\n        dispatch(toggleIsFetching(false))\r\n        dispatch(setUsersAC(data.items));\r\n        dispatch(setTotalUsersCount(data.totalCount));\r\n  }\r\n}\r\n\r\nconst followUnfollowFlow = async (dispatch,userId,apiMethod,AC) => {\r\n  dispatch(toggleFollowingProgress(true,userId));\r\n  let response = await apiMethod(userId)\r\n    if(response.data.resultCode === 0) {\r\n      dispatch(AC(userId));\r\n    }\r\n  dispatch(toggleFollowingProgress(false,userId));\r\n}\r\n\r\nexport const follow = (userId) => { \r\n  return async (dispatch) =>  {\r\n    followUnfollowFlow(dispatch,userId,userAPI.follow.bind(userAPI),acceptFollow);\r\n  }\r\n}\r\nexport const unfollow = (userId) => { \r\n  return async (dispatch) =>  {\r\n    followUnfollowFlow(dispatch,userId,userAPI.unfollow.bind(userAPI),acceptUnfollow);\r\n  }\r\n}\r\nexport default usersReducer;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
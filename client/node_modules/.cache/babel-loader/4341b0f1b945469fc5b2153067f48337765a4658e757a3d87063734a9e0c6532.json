{"ast":null,"code":"let websocket;\nconst closeHanbler = () => {\n  setTimeout(createChannel, 3000);\n};\nconst messageHandler = e => {\n  let newMessages = JSON.parse(e.data);\n  subcribers.forEach(s => s(newMessages));\n};\nfunction createChannel() {\n  var _websocket, _websocket2, _websocket3;\n  (_websocket = websocket) === null || _websocket === void 0 ? void 0 : _websocket.removeEventListener('close', closeHanbler);\n  (_websocket2 = websocket) === null || _websocket2 === void 0 ? void 0 : _websocket2.removeEventListener('close', closeHanbler);\n  (_websocket3 = websocket) === null || _websocket3 === void 0 ? void 0 : _websocket3.close();\n  websocket = new WebSocket('wss://social-network.samuraijs.com/handlers/ChatHandler.ashx');\n  websocket.addEventListener('close', closeHanbler);\n  websocket.addEventListener('message', messageHandler);\n}\nlet subcribers = [];\nexport const chatAPI = {\n  start() {\n    createChannel();\n  },\n  stop() {\n    var _websocket4;\n    subcribers = [];\n    (_websocket4 = websocket) === null || _websocket4 === void 0 ? void 0 : _websocket4.close();\n    websocket.removeEventListener('close', closeHanbler);\n    websocket.removeEventListener('message', messageHandler);\n  },\n  subscribe(callback) {\n    subcribers.push(callback);\n    return () => {\n      subcribers = subcribers.filter(s => s !== callback);\n    };\n  },\n  unsubscribe(callback) {\n    subcribers = subcribers.filter(s => s !== callback);\n  },\n  sendMessage(message) {\n    websocket.send(message);\n  }\n};","map":{"version":3,"names":["websocket","closeHanbler","setTimeout","createChannel","messageHandler","e","newMessages","JSON","parse","data","subcribers","forEach","s","removeEventListener","close","WebSocket","addEventListener","chatAPI","start","stop","subscribe","callback","push","filter","unsubscribe","sendMessage","message","send"],"sources":["C:/Dev/react/project1/src/components/api/chat-api.ts"],"sourcesContent":["export type ChatMessageType = {\r\n    message:string\r\n    photo:string\r\n    userId:number\r\n    userName:string\r\n}\r\ntype SubscriberType = (messages:ChatMessageType[]) => void\r\n\r\n\r\nlet websocket:WebSocket\r\nconst closeHanbler = () => {\r\n    setTimeout(createChannel,3000)\r\n}\r\nconst messageHandler = (e:MessageEvent) => {\r\n    let newMessages = JSON.parse(e.data)\r\n    subcribers.forEach(s => s(newMessages))\r\n}\r\nfunction createChannel() {\r\n    websocket?.removeEventListener('close',closeHanbler)\r\n    websocket?.removeEventListener('close',closeHanbler)\r\n    websocket?.close()\r\n    websocket = new WebSocket('wss://social-network.samuraijs.com/handlers/ChatHandler.ashx')\r\n    websocket.addEventListener('close',closeHanbler) \r\n    websocket.addEventListener('message',messageHandler) \r\n}  \r\n\r\nlet subcribers = [] as Array<SubscriberType>\r\nexport const chatAPI = {\r\n    start() {\r\n        createChannel()\r\n    },\r\n    stop() {\r\n        subcribers = []\r\n        websocket?.close()\r\n        websocket.removeEventListener('close',closeHanbler) \r\n        websocket.removeEventListener('message',messageHandler) \r\n    },\r\n    subscribe(callback:SubscriberType) {\r\n        subcribers.push(callback)\r\n        return () => {\r\n            subcribers = subcribers.filter(s => s !== callback)\r\n        }\r\n    },\r\n    unsubscribe(callback:SubscriberType) {\r\n        subcribers = subcribers.filter(s => s !== callback)\r\n    },\r\n    sendMessage(message:string) {\r\n        websocket.send(message)\r\n    }\r\n}\r\n\r\n"],"mappings":"AASA,IAAIA,SAAmB;AACvB,MAAMC,YAAY,GAAG,MAAM;EACvBC,UAAU,CAACC,aAAa,EAAC,IAAI,CAAC;AAClC,CAAC;AACD,MAAMC,cAAc,GAAIC,CAAc,IAAK;EACvC,IAAIC,WAAW,GAAGC,IAAI,CAACC,KAAK,CAACH,CAAC,CAACI,IAAI,CAAC;EACpCC,UAAU,CAACC,OAAO,CAACC,CAAC,IAAIA,CAAC,CAACN,WAAW,CAAC,CAAC;AAC3C,CAAC;AACD,SAASH,aAAa,GAAG;EAAA;EACrB,cAAAH,SAAS,+CAAT,WAAWa,mBAAmB,CAAC,OAAO,EAACZ,YAAY,CAAC;EACpD,eAAAD,SAAS,gDAAT,YAAWa,mBAAmB,CAAC,OAAO,EAACZ,YAAY,CAAC;EACpD,eAAAD,SAAS,gDAAT,YAAWc,KAAK,EAAE;EAClBd,SAAS,GAAG,IAAIe,SAAS,CAAC,8DAA8D,CAAC;EACzFf,SAAS,CAACgB,gBAAgB,CAAC,OAAO,EAACf,YAAY,CAAC;EAChDD,SAAS,CAACgB,gBAAgB,CAAC,SAAS,EAACZ,cAAc,CAAC;AACxD;AAEA,IAAIM,UAAU,GAAG,EAA2B;AAC5C,OAAO,MAAMO,OAAO,GAAG;EACnBC,KAAK,GAAG;IACJf,aAAa,EAAE;EACnB,CAAC;EACDgB,IAAI,GAAG;IAAA;IACHT,UAAU,GAAG,EAAE;IACf,eAAAV,SAAS,gDAAT,YAAWc,KAAK,EAAE;IAClBd,SAAS,CAACa,mBAAmB,CAAC,OAAO,EAACZ,YAAY,CAAC;IACnDD,SAAS,CAACa,mBAAmB,CAAC,SAAS,EAACT,cAAc,CAAC;EAC3D,CAAC;EACDgB,SAAS,CAACC,QAAuB,EAAE;IAC/BX,UAAU,CAACY,IAAI,CAACD,QAAQ,CAAC;IACzB,OAAO,MAAM;MACTX,UAAU,GAAGA,UAAU,CAACa,MAAM,CAACX,CAAC,IAAIA,CAAC,KAAKS,QAAQ,CAAC;IACvD,CAAC;EACL,CAAC;EACDG,WAAW,CAACH,QAAuB,EAAE;IACjCX,UAAU,GAAGA,UAAU,CAACa,MAAM,CAACX,CAAC,IAAIA,CAAC,KAAKS,QAAQ,CAAC;EACvD,CAAC;EACDI,WAAW,CAACC,OAAc,EAAE;IACxB1B,SAAS,CAAC2B,IAAI,CAACD,OAAO,CAAC;EAC3B;AACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}
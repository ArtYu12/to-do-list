{"ast":null,"code":"let websocket;\nconst closeHanbler = () => {\n  setTimeout(createChannel, 3000);\n};\nconst messageHandler = e => {\n  let newMessages = JSON.parse(e.data);\n  subcribers.forEach(s => s(newMessages));\n};\nconst cleanUp = () => {\n  var _websocket, _websocket2;\n  (_websocket = websocket) === null || _websocket === void 0 ? void 0 : _websocket.removeEventListener('close', closeHanbler);\n  (_websocket2 = websocket) === null || _websocket2 === void 0 ? void 0 : _websocket2.removeEventListener('message', messageHandler);\n};\nfunction createChannel() {\n  var _websocket3;\n  cleanUp();\n  (_websocket3 = websocket) === null || _websocket3 === void 0 ? void 0 : _websocket3.close();\n  websocket = new WebSocket('wss://social-network.samuraijs.com/handlers/ChatHandler.ashx');\n  websocket.addEventListener('close', closeHanbler);\n  websocket.addEventListener('message', messageHandler);\n}\nlet subcribers = {\n  'messages-received': Array,\n  'status-changed': string\n};\nexport const chatAPI = {\n  start() {\n    createChannel();\n  },\n  stop() {\n    var _websocket4;\n    subcribers = [];\n    (_websocket4 = websocket) === null || _websocket4 === void 0 ? void 0 : _websocket4.close();\n    cleanUp();\n  },\n  subscribe(eventName, callback) {\n    subcribers.push(callback);\n    return () => {\n      subcribers = subcribers.filter(s => s !== callback);\n    };\n  },\n  unsubscribe(callback) {\n    subcribers = subcribers.filter(s => s !== callback);\n  },\n  sendMessage(message) {\n    websocket.send(message);\n  }\n};","map":{"version":3,"names":["websocket","closeHanbler","setTimeout","createChannel","messageHandler","e","newMessages","JSON","parse","data","subcribers","forEach","s","cleanUp","removeEventListener","close","WebSocket","addEventListener","Array","string","chatAPI","start","stop","subscribe","eventName","callback","push","filter","unsubscribe","sendMessage","message","send"],"sources":["C:/Dev/react/project1/src/components/api/chat-api.ts"],"sourcesContent":["export type ChatMessageType = {\r\n    message:string\r\n    photo:string\r\n    userId:number\r\n    userName:string\r\n}\r\n\r\n\r\ntype EventsNamesType = 'messages-received' | 'status-changed'\r\ntype SubscriberType = (messages:ChatMessageType[]) => void\r\n\r\n\r\nlet websocket:WebSocket\r\nconst closeHanbler = () => {\r\n    setTimeout(createChannel,3000)\r\n}\r\nconst messageHandler = (e:MessageEvent) => {\r\n    let newMessages = JSON.parse(e.data)\r\n    subcribers.forEach(s => s(newMessages))\r\n}\r\n\r\nconst cleanUp = () => {\r\n    websocket?.removeEventListener('close',closeHanbler)\r\n    websocket?.removeEventListener('message',messageHandler)\r\n}\r\nfunction createChannel() {\r\n    cleanUp()\r\n    websocket?.close()\r\n    websocket = new WebSocket('wss://social-network.samuraijs.com/handlers/ChatHandler.ashx')\r\n    websocket.addEventListener('close',closeHanbler) \r\n    websocket.addEventListener('message',messageHandler) \r\n}  \r\n\r\nlet subcribers = {\r\n    'messages-received':Array<SubscriberType>,\r\n    'status-changed':string\r\n}\r\nexport const chatAPI = {\r\n    start() {\r\n        createChannel()\r\n    },\r\n    stop() {\r\n        subcribers = []\r\n        websocket?.close()\r\n        cleanUp() \r\n    },\r\n    subscribe(eventName: EventsNamesType,callback:SubscriberType) {\r\n        subcribers.push(callback)\r\n        return () => {\r\n            subcribers = subcribers.filter(s => s !== callback)\r\n        }\r\n    },\r\n    unsubscribe(callback:SubscriberType) {\r\n        subcribers = subcribers.filter(s => s !== callback)\r\n    },\r\n    sendMessage(message:string) {\r\n        websocket.send(message)\r\n    }\r\n}\r\n\r\n"],"mappings":"AAYA,IAAIA,SAAmB;AACvB,MAAMC,YAAY,GAAG,MAAM;EACvBC,UAAU,CAACC,aAAa,EAAC,IAAI,CAAC;AAClC,CAAC;AACD,MAAMC,cAAc,GAAIC,CAAc,IAAK;EACvC,IAAIC,WAAW,GAAGC,IAAI,CAACC,KAAK,CAACH,CAAC,CAACI,IAAI,CAAC;EACpCC,UAAU,CAACC,OAAO,CAACC,CAAC,IAAIA,CAAC,CAACN,WAAW,CAAC,CAAC;AAC3C,CAAC;AAED,MAAMO,OAAO,GAAG,MAAM;EAAA;EAClB,cAAAb,SAAS,+CAAT,WAAWc,mBAAmB,CAAC,OAAO,EAACb,YAAY,CAAC;EACpD,eAAAD,SAAS,gDAAT,YAAWc,mBAAmB,CAAC,SAAS,EAACV,cAAc,CAAC;AAC5D,CAAC;AACD,SAASD,aAAa,GAAG;EAAA;EACrBU,OAAO,EAAE;EACT,eAAAb,SAAS,gDAAT,YAAWe,KAAK,EAAE;EAClBf,SAAS,GAAG,IAAIgB,SAAS,CAAC,8DAA8D,CAAC;EACzFhB,SAAS,CAACiB,gBAAgB,CAAC,OAAO,EAAChB,YAAY,CAAC;EAChDD,SAAS,CAACiB,gBAAgB,CAAC,SAAS,EAACb,cAAc,CAAC;AACxD;AAEA,IAAIM,UAAU,GAAG;EACb,mBAAmB,EAACQ,KAAqB;EACzC,gBAAgB,EAACC;AACrB,CAAC;AACD,OAAO,MAAMC,OAAO,GAAG;EACnBC,KAAK,GAAG;IACJlB,aAAa,EAAE;EACnB,CAAC;EACDmB,IAAI,GAAG;IAAA;IACHZ,UAAU,GAAG,EAAE;IACf,eAAAV,SAAS,gDAAT,YAAWe,KAAK,EAAE;IAClBF,OAAO,EAAE;EACb,CAAC;EACDU,SAAS,CAACC,SAA0B,EAACC,QAAuB,EAAE;IAC1Df,UAAU,CAACgB,IAAI,CAACD,QAAQ,CAAC;IACzB,OAAO,MAAM;MACTf,UAAU,GAAGA,UAAU,CAACiB,MAAM,CAACf,CAAC,IAAIA,CAAC,KAAKa,QAAQ,CAAC;IACvD,CAAC;EACL,CAAC;EACDG,WAAW,CAACH,QAAuB,EAAE;IACjCf,UAAU,GAAGA,UAAU,CAACiB,MAAM,CAACf,CAAC,IAAIA,CAAC,KAAKa,QAAQ,CAAC;EACvD,CAAC;EACDI,WAAW,CAACC,OAAc,EAAE;IACxB9B,SAAS,CAAC+B,IAAI,CAACD,OAAO,CAAC;EAC3B;AACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}